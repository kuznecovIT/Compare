rpc.exports = {
    init: function () {
        const myLib = 'libViewRightVideoMarkClient.so';
        const myOffset = '0xA62E0';

        const handler = Interceptor.attach(Module.findExportByName(null, 'open'), {
            onEnter: function (args) {
                this.path = Memory.readUtf8String(args[0]);
            },
            onLeave: function () {
                if (this.path.includes(myLib)) {
                    handler.detach();

                    setTimeout(function () {
                        const myBase = Module.findBaseAddress(myLib);
                        const myAddr = ptr(myBase).add(myOffset);

                        Interceptor.replace(myAddr, new NativeCallback(function () {
                            return 1;
                        }, 'int', ['int']));

                        Java.perform(function () {
                            Java.use('android.util.Log').v('RTTV', 'anti-root applied!');
                        });
                    }, 5000);
                }
            }
        });
    }
};
